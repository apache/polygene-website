<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Core Extension SPI</title><link rel="stylesheet" type="text/css" href="css/style.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.76.1" /><link rel="home" href="index.html" title="" /><link rel="up" href="core.html" title="Core" /><link rel="prev" href="core-testsupport.html" title="Core Test Support" /><link rel="next" href="core-runtime.html" title="Core Runtime" />


<!-- favicon -->

<link rel="shortcut icon" href="http://polygene.apache.org/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="icon" href="http://polygene.apache.org/favicon.ico" type="image/x-icon" />

<!-- style -->

<link href="css/shCore.css" rel="stylesheet" type="text/css" />
<link href="css/shCoreEclipse.css" rel="stylesheet" type="text/css" />
<link href="css/shThemeEclipse.css" rel="stylesheet" type="text/css" />
<link href="css/polygene.css" rel="stylesheet" type="text/css" />

<!-- Syntax Highlighter -->

<script type="text/javascript" src="js/shCore.js"></script>
<script type="text/javascript" src="js/shBrushJava.js"></script>
<script type="text/javascript" src="js/shBrushScala.js"></script>
<script type="text/javascript" src="js/shBrushJScript.js"></script>
<script type="text/javascript" src="js/shBrushBash.js"></script>
<script type="text/javascript" src="js/shBrushPlain.js"></script>
<script type="text/javascript" src="js/shBrushXml.js"></script>
<script type="text/javascript" src="js/shBrushGroovy.js"></script>
<script type="text/javascript" src="js/shBrushPython.js"></script>
<script type="text/javascript" src="js/shBrushRuby.js"></script>
<script type="text/javascript" src="js/shBrushCSharp.js"></script>

<script type="text/javascript">
  SyntaxHighlighter.defaults['tab-size'] = 4;
  SyntaxHighlighter.defaults['gutter'] = false;
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all()
</script>

<!-- JQuery -->

<script type="text/javascript" src="js/jquery-1.6.4.min.js"></script>

<!-- Image Scaler -->

<script type="text/javascript" src="js/imagescaler.js"></script>

<!-- Table Styler -->

<script type="text/javascript" src="js/tablestyler.js"></script>

<!-- Apache Polygene WebSite Progressive Enhancement -->

<link href="css/progressive-enhancement.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/jquery.scrollTo-1.4.2.js"></script>
<script type="text/javascript" src="js/progressive-enhancement.js"></script>

<!-- Analytics -->
 <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-62007352-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
 </script>

  </head><body><div xmlns="" xmlns:exsl="http://exslt.org/common" class="logo"><a href="index.html"><img src="images/logo-standard.png" /></a></div><div xmlns="" xmlns:exsl="http://exslt.org/common" class="top-nav"><div xmlns="http://www.w3.org/1999/xhtml" class="toc"><dl><dt><span class="section"><a href="index.html#home">Polygene™</a></span></dt><dt><span class="section"><a href="intro.html">Introduction</a></span></dt><dt><span class="section"><a href="tutorials.html">Tutorials</a></span></dt><dt><span class="section"><a href="javadocs.html">Javadoc</a></span></dt><dt><span class="section"><a href="samples.html">Samples</a></span></dt><dt><span class="section"><span xmlns="" href="core.html">Core</span></span></dt><dt><span class="section"><a href="libraries.html">Libraries</a></span></dt><dt><span class="section"><a href="extensions.html">Extensions</a></span></dt><dt><span class="section"><a href="tools.html">Tools</a></span></dt><dt><span class="section"><a href="glossary.html">Glossary </a></span></dt></dl></div></div><div xmlns="" xmlns:exsl="http://exslt.org/common" class="sub-nav"><div xmlns="http://www.w3.org/1999/xhtml" class="toc"><dl><dt><span class="section"><a href="core.html#_overview_3">Overview</a></span></dt><dt><span class="section"><a href="core-api.html">Core API</a></span></dt><dt><span class="section"><a href="core-bootstrap-assembly.html">Core Bootstrap</a></span></dt><dt><span class="section"><a href="core-testsupport.html">Core Test Support</a></span></dt><dt><span class="section"><span xmlns="" href="core-spi.html">Core Extension SPI</span></span></dt><dt><span class="section"><a href="core-runtime.html">Core Runtime</a></span></dt></dl></div></div><div class="section" title="Core Extension SPI"><div class="titlepage"><div><div><h3 class="title"><a id="core-spi"></a>Core Extension SPI</h3></div></div></div><p class="remark"><em><span class="comment"></span></em></p><p class="devstatus-code-stable">code</p><p class="devstatus-docs-brief">docs</p><p class="devstatus-tests-good">tests</p><p>The Polygene™ Core Runtime has a number of extension points, which we call the <span class="emphasis"><em>Polygene Core Extension SPI</em></span>. These are defined
interfaces used <span class="strong"><strong>only</strong></span> by the Core Runtime and <span class="strong"><strong>never</strong></span> directly by application code. <a class="xref" href="extensions.html" title="Extensions">Extensions</a> are assembled in
applications during the bootstrap phase.</p><div class="table"><a id="idm229755031600"></a><p class="title"><strong>Table 17. Artifact</strong></p><div class="table-contents"><table summary="Artifact" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /></colgroup><thead><tr><th align="left" valign="top">Group ID</th><th align="left" valign="top">Artifact ID</th><th align="left" valign="top">Version</th></tr></thead><tbody><tr><td align="left" valign="top"><p>org.apache.polygene.core</p></td><td align="left" valign="top"><p>org.apache.polygene.core.spi</p></td><td align="left" valign="top"><p>3.1.0-SNAPSHOT</p></td></tr></tbody></table></div></div><br class="table-break" /><p>There are currently 5 Core SPI extensions;</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
<a class="xref" href="core-spi.html#core-spi-serialization" title="Serialization SPI">Serialization SPI</a>
</li><li class="listitem">
<a class="xref" href="core-spi.html#core-spi-entitystore" title="EntityStore SPI">EntityStore SPI</a>
</li><li class="listitem">
<a class="xref" href="core-spi.html#core-spi-cache" title="Cache SPI">Cache SPI</a>
</li><li class="listitem">
<a class="xref" href="core-spi.html#core-spi-indexing" title="Indexing/Query SPI">Indexing/Query SPI</a>
</li><li class="listitem">
<a class="xref" href="core-spi.html#core-spi-metrics" title="Metrics SPI">Metrics SPI</a>
</li></ul></div><p>Polygene™ Runtime Extensions implementations may depend on Polygene™ Libraries, but Libraries are NOT ALLOWED to depend on
Extensions. Applications code is NOT ALLOWED to depend on extensions. And application code SHOULD NOT depend on the
Core Extension SPI. If you think that is needed, please contact <a class="ulink" href="mailto:users@dev.apache.org" target="_top">users@dev.apache.org</a> mailing list, to see if your usecase
can be solved in a support manner, or that we need to extend the Core API to support it.</p><div class="section" title="Serialization SPI"><div class="titlepage"><div><div><h4 class="title"><a id="core-spi-serialization"></a>Serialization SPI</h4></div></div></div><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>Find Serialization extensions in the <a class="xref" href="extensions.html" title="Extensions">Extensions</a> list.</p></div><div class="section" title="Overview"><div class="titlepage"><div><div><h5 class="title"><a id="_overview_4"></a>Overview</h5></div></div></div><p>The Polygene™ Core Runtime use Serialization to provide string representation of ValueComposites via their <code class="literal">toString()</code>
method, and, their instantiation from the very same representation via the <code class="literal">newValueFromSerializedState(..)</code> method of
the ValueBuilderFactory API.</p><pre class="programlisting brush: java">public interface SomeValue // (1)
{
    Property&lt;String&gt; foo();
}

@Override
public void assemble( ModuleAssembly module )
{
    module.values( SomeValue.class ); // (2)
      [...snip...]

    module.defaultServices(); // (3)
      [...snip...]

}
  [...snip...]

public void defaultSerialization()
{
    SomeValue someValue = someNewValueInstance(); // (4)
    String json = someValue.toString(); // (5)
    SomeValue someNewValue = valueBuilderFactory.newValueFromSerializedState( SomeValue.class, json ); // (6)
      [...snip...]

}

</pre><p>In each Module, if no Serialization service is assembled, a default one supporting the JSON format is used.</p><pre class="programlisting brush: java">public interface SomeValue // (1)
{
    Property&lt;String&gt; foo();
}

@Override
public void assemble( ModuleAssembly module )
{
    module.values( SomeValue.class ); // (2)
      [...snip...]

    new JavaxJsonSerializationAssembler().assemble( module ); // (3)
      [...snip...]

}
  [...snip...]

@Service
private Serializer serializer; // (4)
@Service
private Deserializer deserializer; // (4)

  [...snip...]

public void assembledDefaultServiceSerialization()
{
    SomeValue someValue = someNewValueInstance(); // (5)
    String json = serializer.serialize( someValue ); // (6)
    SomeValue someNewValue = deserializer.deserialize( module, SomeValue.class, json ); // (7)
      [...snip...]

}
</pre></div><div class="section" title="Text or Binary?"><div class="titlepage"><div><div><h5 class="title"><a id="_text_or_binary"></a>Text or Binary?</h5></div></div></div><p>The Core SPI provides adapters for text or bytes based serialization, extends the following types to implement a custom
serialization.</p><p>For text based serialization:</p><pre class="programlisting brush: java">/**
 * Base Text Serializer.
 *
 * Implementations work on Strings, this base serializer encode these strings in UTF-8 to produce bytes.
 *
 * See {@link AbstractTextDeserializer}.
 */
public abstract class AbstractTextSerializer extends AbstractSerializer
</pre><pre class="programlisting brush: java">/**
 * Base Text Deserializer.
 *
 * Implementations work on Strings, this base deserializer decode bytes in UTF-8 to produce strings.
 *
 * See {@link AbstractTextSerializer}.
 */
public abstract class AbstractTextDeserializer extends AbstractDeserializer
</pre><p>For bytes based serialization:</p><pre class="programlisting brush: java">/**
 * Base Binary Serializer.
 *
 * Implementations work on bytes, this base serializer encode these bytes in Base64 to produce Strings.
 *
 * See {@link AbstractBinaryDeserializer}.
 */
public abstract class AbstractBinarySerializer extends AbstractSerializer
</pre><pre class="programlisting brush: java">/**
 * Base Binary Deserializer.
 *
 * Implementations work on bytes, this base deserializer decode Strings from Base64 to produce bytes.
 *
 * See {@link AbstractBinarySerializer}.
 */
public abstract class AbstractBinaryDeserializer extends AbstractDeserializer
</pre></div><div class="section" title="JSON or XML?"><div class="titlepage"><div><div><h5 class="title"><a id="_json_or_xml"></a>JSON or XML?</h5></div></div></div><p>The Core SPI provides JSON and XML serialization respectively based on <code class="literal">javax.json</code> and <code class="literal">javax.xml</code> types and APIs to
work directly with these types so you can work with the actual object representations without serializing to text or
bytes. They both rely on the text serialization adapters shown above.</p><p>Here is an example using the <code class="literal">JsonSerialization</code> service:</p><pre class="programlisting brush: java">@Service
JsonSerialization jsonSerialization;
  [...snip...]

    try( UnitOfWork uow = unitOfWorkFactory.newUnitOfWork() )
    {
        Some valueInstance = buildSomeValue( moduleInstance, uow, "42" );

        // Serialize using injected service
        JsonValue serializedJson = jsonSerialization.toJson( valueInstance );
        System.out.println( serializedJson.toString() );

        // Deserialize using Module API
        Some valueFromSerializedState = moduleInstance.newValueFromSerializedState( Some.class, serializedJson.toString() );
        assertThat( "Deserialized Value equality", valueInstance, equalTo( valueFromSerializedState ) );
          [...snip...]

    }
</pre><p>And another using the <code class="literal">XmlSerialization</code> service:</p><pre class="programlisting brush: java">@Service
XmlSerialization xmlSerialization;
  [...snip...]

    try( UnitOfWork uow = unitOfWorkFactory.newUnitOfWork() )
    {
        Some valueInstance = buildSomeValue( moduleInstance, uow, "42" );

        // Serialize using injected service
        String serializedXml = xmlSerialization.serialize( valueInstance );
        System.out.println( serializedXml );

        // Deserialize using Module API
        Some valueFromSerializedState = moduleInstance.newValueFromSerializedState( Some.class, serializedXml );
        assertThat( "Deserialized Value equality", valueInstance, equalTo( valueFromSerializedState ) );
          [...snip...]

    }
</pre></div><div class="section" title="Implementation notes"><div class="titlepage"><div><div><h5 class="title"><a id="_implementation_notes"></a>Implementation notes</h5></div></div></div><p>Simply implement Serialization to create an extension for the Serialization SPI.
The Core SPI module provides adapters to create Serializers and Deserializers.</p><p>The behaviour described here apply to all Serialization services implemented using the Core SPI adapters. Note that
nothing stops you from implementing an extension for the Serialization SPI without relying on theses adapters.</p><p>Theses adapters are tailored for serialization mechanisms that support the following two structures that can be nested:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
a collection of name/value pairs. In various languages, this is realized as an object, record, struct,
      dictionary, hash table, keyed list, or associative array,
</li><li class="listitem">
an ordered list of values. In most languages, this is realized as an array, vector, list, or sequence ;
</li></ul></div><p>in other words, a JSON-like structure.</p></div></div><div class="section" title="EntityStore SPI"><div class="titlepage"><div><div><h4 class="title"><a id="core-spi-entitystore"></a>EntityStore SPI</h4></div></div></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>This SPI has no documentation yet. Learn how to contribute in <a class="xref" href="community-docs.html" title="Polygene™ Documentation">Writing Documentation</a>.</p></div></div><div class="section" title="Cache SPI"><div class="titlepage"><div><div><h4 class="title"><a id="core-spi-cache"></a>Cache SPI</h4></div></div></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>This SPI has no documentation yet. Learn how to contribute in <a class="xref" href="community-docs.html" title="Polygene™ Documentation">Writing Documentation</a>.</p></div></div><div class="section" title="Indexing/Query SPI"><div class="titlepage"><div><div><h4 class="title"><a id="core-spi-indexing"></a>Indexing/Query SPI</h4></div></div></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>This SPI has no documentation yet. Learn how to contribute in <a class="xref" href="community-docs.html" title="Polygene™ Documentation">Writing Documentation</a>.</p></div></div><div class="section" title="Metrics SPI"><div class="titlepage"><div><div><h4 class="title"><a id="core-spi-metrics"></a>Metrics SPI</h4></div></div></div><p>It is very easy to create an extension for the Metrics SPI, simply by implementing the MetricsProvider. If only a
subset of the factories/types are supported, there is a convenience adapter call MetricsProviderAdapter in the Metrics
SPI package.</p></div></div><div xmlns="" xmlns:exsl="http://exslt.org/common" class="footer"><p>
        Copyright © 2015 The Apache Software Foundation, Licensed under the <a href="http://www.apache.org/licenses/" target="_blank">Apache License, Version 2.0</a>.
        <br /><small>
            Apache Polygene, Polygene, Apache, the Apache feather logo, and the Apache Polygene project logo are trademarks of The Apache Software Foundation.<br />
            All other marks mentioned may be trademarks or registered trademarks of their respective owners.
        </small></p></div></body></html>